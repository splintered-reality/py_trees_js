<html>
<head>
  <meta charset="utf-8">
  <title>PyTrees Viz</title>
  <link rel="stylesheet" href="py_trees-0.2.0.css">
</head>
<script src="jointjs/dagre-0.8.4.min.js"></script>
<script src="jointjs/graphlib-2.1.7.min.js"></script>
<script src="jointjs/jquery-3.4.1.min.js"></script>
<script src="jointjs/lodash-4.17.11.min.js"></script>
<script src="jointjs/backbone-1.4.0.js"></script>
<script src="jointjs/joint-3.0.2.min.js"></script>
<script src="py_trees-0.2.0.js"></script>
<link rel="stylesheet" type="text/css" href="jointjs/joint-3.0.2.min.css"/>
<style>
  body {
    margin: 0;
  }
</style>
<body>
  <div id="foo"></div>
  <script type="text/javascript">
    py_trees.print_versions()
  </script>
  <div id="window">
    <div id="canvas"></div>
    <div id="timeline"></div>
  </div>
  <script type="text/javascript">
    graph = new joint.dia.Graph({});
    paper = py_trees.create_paper({graph: graph})
    timeline_graph = new joint.dia.Graph({tree_cache: []});
    timeline_paper = py_trees.create_timeline_paper({graph: timeline_graph})

    // Accept a tree from external sources
    already_rendered = false
    render_tree = function({tree}) {
      json_tree = JSON.parse(tree)
      py_trees.update_graph({graph: graph, tree: json_tree})
      py_trees.layout_graph({graph: graph})
      timeline_graph.attributes.tree_cache.push(json_tree)
      if (!already_rendered) {
        py_trees.fit_content_to_canvas(paper)
        already_rendered = true
        return "rendered"
      } else {
    	console.log(json_tree)
    	console.log(timeline_graph.attributes.tree_cache)
        return "already rendered"
      }
    }
  </script>
</body>
</html>
