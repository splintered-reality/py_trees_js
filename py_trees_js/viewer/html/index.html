<html>
<head>
  <meta charset="utf-8">
  <title>PyTrees Viewer</title>
</head>
<script src="js/jointjs/dagre-0.8.4.min.js"></script>
<script src="js/jointjs/graphlib-2.1.7.min.js"></script>
<script src="js/jointjs/jquery-3.4.1.min.js"></script>
<script src="js/jointjs/lodash-4.17.11.min.js"></script>
<script src="js/jointjs/backbone-1.4.0.js"></script>
<script src="js/jointjs/joint-3.0.2.min.js"></script>
<script src="js/py_trees-0.3.1.js"></script>
<link rel="stylesheet" href="js/py_trees-0.3.1.css">
<link rel="stylesheet" type="text/css" href="js/jointjs/joint-3.0.2.min.css"/>
<style>
  body {
    margin: 0;
  }
</style>
<body>
  <script type="text/javascript">
    py_trees.print_versions()
  </script>
  <div id="window">
    <div id="canvas"></div>
    <div id="timeline"></div>
  </div>
  <script type="text/javascript">
    // Canvas for rendering the tree
    graph = new joint.dia.Graph({});
    paper = py_trees.create_paper({graph: graph})

    // Canvas for rendering the timeline bar
    timeline_graph = py_trees.timeline.create_graph({event_cache_limit: 100});
    timeline_paper = py_trees.timeline.create_paper({
        timeline_graph: timeline_graph,
        canvas_graph: graph,
        canvas_paper: paper,
    })
    $(window).resize(function() {
      console.log("Window resizing")
      py_trees.timeline.scale_content_to_fit(timeline_paper)
    })

    // Accept incoming trees - cache & render them
    already_rendered = false
    render_tree = function({tree}) {
      deserialised_tree = JSON.parse(tree)
      if ( timeline_graph.get('streaming') ) {
          py_trees.update_graph({graph: graph, tree: deserialised_tree})
          py_trees.layout_graph({graph: graph})
      }
      py_trees.timeline.add_tree_to_cache({graph: timeline_graph, tree: deserialised_tree})
      if (!already_rendered) {
        py_trees.scale_content_to_fit(paper)
        already_rendered = true
        return "rendered"
      } else {
        return "already rendered"
      }
    }
  </script>
</body>
</html>
